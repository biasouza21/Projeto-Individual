<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="stylesheet" href="/css/quests_markus.css">
    <link rel="shortcut icon" href="../assets/logo.ico" type="image/x-icon">


    <title>SurQ | Markus</title>
</head>

<body>
    <div id="containerid" class="container">
        <div class="questions-container hide">
            <span class="question">Pergunta aqui</span>
            <div class="answers-container">
                <button class="answer button">Resposta 1</button>
                <button class="answer button">Resposta 2</button>
                <button class="answer button">Resposta 3</button>
                <button class="answer button">Resposta 4</button>
            </div>
        </div>
        <div class="controls-container">
            <button class="start-quiz button">Começar teste</button>
            <button class="next-question button hide">Próxima pergunta</button>
        </div>
    </div>

    <div id="missaoConcluida" style="display: none;">
        <div class="div_frase">
            <span class="frase_markus">“Parabéns Markus... Você <br>
                fez história... Talvez você seja o <br> que a gente estava <br> esperando...”</span>
        </div>

        <div class="div_conclusao">
            <button onclick="location.href='../dashboard/dashboard.html'" class="btn_refazer_teste"
                style="display: none; position: absolute">
                Ver dashboard
            </button>
            <!-- <button onclick="window.location='quiz.html'" class="btn_voltarQuiz">Voltar para quiz</button> -->
            <ul class="lista_sobreviventes">
                <li>Markus sobreviveu</li>
                <li>North sobreviveu</li>
                <li>Josh sobreviveu</li>
                <li>Simon sobreviveu</li>
            </ul>

            <span class="conclusao">Os sobreviventes conseguem fugir <br> pelo telhado, você escolheu boas <br> abordagens e a opinião pública foi <br> boa. Bom trabalho.</span>
        </div>

    </div>

    <div id="missaoFracassada" style="display: none;">
        <div class="div_frase">
            <span class="frase_markus_guerra">“Esta mensagem é claramente uma declaração de guerra”</span>
        </div>


        <div class="div_conclusao">
            <button onclick="location.href='../dashboard/dashboard.html'" class="btn_refazer_teste"
                style="display: none; position: absolute">
                Ver dashboard
            </button>
            <!-- <button onclick="window.location='quiz.html'" class="btn_voltarQuiz">Voltar para tela de quiz -->
            </button>
            <ul class="lista_sobreviventes">
                <li>Markus sobreviveu</li>
                <li>North sobreviveu</li>
                <li>Josh sobreviveu</li>
                <li>Simon sobreviveu</li>
            </ul>
            <span class="conclusao">Sua escolha de palavras não agradou a <br> opinião pública. Seu discurso foi interpretado <br> como uma mensagem de guerra. Isso vai prejudicar não <br> só a você, mas também todos os androids.</span>

        </div>
    </div>

    <div id="sacrificio" style="display: none;">
        <div class="div_frase">
            <span class="frase_markus_sacrificio">"Sempre tem outra escolha..."</span>
        </div>


        <div class="div_conclusao">
            <button onclick="location.href='../dashboard/dashboard.html'" class="btn_refazer_teste"
                style="display: none; position: absolute">
                Ver dashboard
            </button>

            <!-- <button onclick="location.href='quiz.html'" class="btn_voltarQuiz">Voltar para tela de quiz</button> -->
            <ul class="lista_sobreviventes">
                <li>Markus sobreviveu</li>
                <li>North sobreviveu</li>
                <li>Josh sobreviveu</li>
                <li>Simon morreu</li>
            </ul>

            <span class="conclusao">Os sobreviventes conseguem fugir <br> pelo telhado, mas Simon pagou com a <br> vida pela sua escolha de atacar os <br> guardas. Será mesmo que era a melhor <br> opção?</span>
        </div>
    </div>
</body>


</html>

<script>
    let showMissaoCompleta = document.getElementById("missaoConcluida");
    let showMissaoFracassada = document.getElementById("missaoFracassada");
    let showSacrificio = document.getElementById("sacrificio");

    let refazerCompleta = document.getElementsByClassName("btn_refazer_teste")[0]
    let refazerFracassada = document.getElementsByClassName("btn_refazer_teste")[1]
    let refazerSacrificio = document.getElementsByClassName("btn_refazer_teste")[2]

    const questions = [
    {
        question: "Depois de entrar e se infiltrar na Torre de Stratford, a emissora de TV, Markus, North, Simon e Josh se encontram no corredor com dois seguranças na porta. Josh afirma que vocês não podem usar violência contra os humanos, mas North afirma que sua causa é mais importante que a vida de dois guardas. 'O que quer fazer, Markus?'",
            answers: [
                { text: 'Ardil', points: +5 },
                { text: 'Atacar', points: -200 }
            ]
        },
        {
            question: "Entrando na sala de transmissão e expulsando os funcionários, a missão começa. Você tira a textura da sua pele, deixando apenas a lataria a vista e inicia o discurso para a cidade inteira. Você inicia o discurso com:",
            answers: [
                { text: 'Calma', points: +5 },
                { text: 'Determinação', points: +2 }
            ]
        },
        {
            question: "O segundo tópico do seu discurso para convencer os humanos será: ",
            answers: [
                { text: 'Reconhecimento', points: -0 },
                { text: 'Direitos iguais', points: +1 },
                { text: 'Fim da escravidão', points: +2.5 },
                { text: 'Liberdade de expressão', points: +2.5 }
            ]
        },
        {
            question: "O terceiro tópico do seu discurso será:",
            answers: [
                { text: 'Reconhecimento', points: -0 },
                { text: 'Direitos iguais', points: +1 },
                { text: 'Fim da escravidão', points: +2.5 },
                { text: 'Liberdade de expressão', points: +2.5 }
            ]
        },
        {
            question: "O quarto tópico do seu discurso será:",
            answers: [
                { text: "Justiça", points: +2.5 },
                { text: "Segregação", points: -10 },
                { text: "Trabalho", points: -5 },
                { text: "Direitos civis", points: +2.5 }
            ]
        },
        {
            question: "O quinto tópico do seu discurso será:",
            answers: [
            { text: "Justiça", points: +2.5 },
                { text: "Segregação", points: -10 },
                { text: "Trabalho", points: -5 },
                { text: "Direitos civis", points: +2.5 }
            ]
        },
        {
            question: "O sexto tópico do seu discurso será:",
            answers: [
                { text: 'Direito à propriedade', points: +5 },
                { text: 'Meios de produção', points: -5 },
                { text: 'Território', points: -10 }
            ]
        },
        {
            question: "Você deve finalizar seu discurso. Qual será sua abordagem?",
            answers: [
                { text: 'Pacifismo', points: +5 },
                { text: 'Determinação', points: +2 },
            ]
        },
    ];
    /*questions é um array que armazena todas as perguntas*/
    /*answers é um array aninhado (um array dentro do outro) que armazena as respostas. A cada resposta foi atribuida uma quantidade de pontos, que é somada ou subtraida ao total de pontos iniciais (65, armazenado na let totalPoints)*/

    const $startGameButton = document.querySelector(".start-quiz");
    const $nextQuestionButton = document.querySelector(".next-question");
    const $questionsContainer = document.querySelector(".questions-container");
    const $questionText = document.querySelector(".question");
    const $answersContainer = document.querySelector(".answers-container");

    let currentQuestionIndex = 0;
    let totalPoints = 65;

    $startGameButton.addEventListener("click", startGame);
    $nextQuestionButton.addEventListener("click", displayNextQuestion);

    function startGame() {
        $startGameButton.classList.add("hide");
        $questionsContainer.classList.remove("hide");
        displayNextQuestion();
    }

    function displayNextQuestion() {
        resetState();
        if (currentQuestionIndex >= questions.length) {
            return finishGame();
        }
        const currentQuestion = questions[currentQuestionIndex];
        $questionText.textContent = currentQuestion.question;
        currentQuestion.answers.forEach(answer => {
            const newAnswer = document.createElement("button");
            newAnswer.classList.add("button", "answer");
            newAnswer.textContent = answer.text;
            newAnswer.dataset.points = answer.points;
            $answersContainer.appendChild(newAnswer);

            newAnswer.addEventListener("click", selectAnswer);
        });
    }

    function resetState() {
        while ($answersContainer.firstChild) {
            $answersContainer.removeChild($answersContainer.firstChild);
        }
        document.body.removeAttribute("class");
        $nextQuestionButton.classList.add("hide");
    }

    function selectAnswer(event) {
        const answerClicked = event.target;
        changeColor(answerClicked);

        totalPoints += parseInt(answerClicked.dataset.points);

        document.querySelectorAll(".answer").forEach(button => {
            button.disabled = true;
        });

        $nextQuestionButton.classList.remove("hide");
        currentQuestionIndex++;
    }

    function changeColor(button) {
        button.style.backgroundColor = "black";
        button.style.color = "white";
    }

    function finishGame() {
        const performance = totalPoints;
        let message = "";

        switch (true) {
            case (performance > 0 && performance <= 79):
                containerid.style.display = "none";
                showMissaoFracassada.style.display = "block";
                refazerFracassada.style.display = "block";
                break;
            case (performance >= 80 && performance <= 100):
                containerid.style.display = "none";
                showMissaoCompleta.style.display = "block";
                refazerCompleta.style.display = "block";
                break;
            case (performance <= 0):
                containerid.style.display = "none";
                showSacrificio.style.display = "block";
                refazerSacrificio.style.display = "block";
                break;
            default:
                message = "Resultado inesperado";
        }
        
        console.log(sessionStorage.ID_USUARIO)
        console.log(sessionStorage.getItem('ID_USUARIO')) 
        
        fetch("/quiz/cadastrar-tentativa", {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
            },
            body: JSON.stringify({
                pontuacaoServer: performance,
                fkQuizServer: 3,
                fkUsuarioServer: sessionStorage.ID_USUARIO
            }),
        })
            .then((resposta) => {
                console.log("resposta: ", resposta);
                
                if (resposta.ok) {
                    console.log('cadastrado');

                }
            })
            .catch((resposta) => {
                console.log(`#ERRO: ${resposta}`);
                
                return;
            })
    }
            
            
        </script>